---
title: "Speakers in the Congressional Recored"
subtitle: 
author: ""
output:
  html_document:
    highlight: zenburn
    toc: true
    toc_float: true
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
source(here::here("code/setup.R"))
```




## Parsed text

.txt files are saved on the Linstat server which you can access on your own computer as a [network drive](https://kb.wisc.edu/sscc/95802) or via the [Winstat VPN](https://kb.wisc.edu/sscc/working-from-home-or-other-remote-locations).
```{r}
knitr::include_graphics(here("figs", "winstat.png"))
```


## Counts of total speeches 

Because the parsed .txt files are saved in subfolders by year/icpsr, counts per member per year are just the number of files in each folder (see [code/count_speeches.R](https://github.com/judgelord/cr/blob/master/code/count_speeches.R)) 

```{r, cache=TRUE}
# from code/count_speeches.R
load(here('data', 'd_count.Rdata'))

# from voteview 
load(here('data', 'members.Rdata'))

# join speech counts with voteview 
d <- d_count %>% left_join(members)

d %<>% filter(year < 2021, chamber %in% c("House", "Senate"))

# name + district strings for display
d %<>% mutate(name_district = bioname %>% str_remove(",.*") %>% str_to_title() %>% paste(cqlabel)) %>% 
  mutate(district_name = cqlabel %>% str_c(bioname, sep = ": ") %>% str_remove_all(",.*|\\(|\\)"))
```


### Most speeches per year 
```{r}
d %>% 
  select(year, name_district, icpsr, n_speeches) %>% 
  arrange(-n_speeches) %>% kablebox()
```

---

### The Wisconsin delegation
```{r wi, fig.height=11}
d %>% 
  filter(state_abbrev == "WI",!is.na(year)) %>% 
  ggplot() +
  aes(x = n_speeches, y = district_name, fill = nominate.dim1) + 
  geom_col() + 
  facet_wrap("year", scales = "free_y", ncol = 2) +
  labs(y = "", x  = "Total Number of Speeches") +
  scale_fill_gradient2(low = muted("blue"), high = muted("red"), mid = "grey80")
```


---

### Average speeches per year for members of the House

```{r reps}
# as a table per member 
d %>% 
  filter(chamber == "House") %>%
  group_by(name_district) %>% 
  summarise(average_speeches = mean(n_speeches) %>% round() ) %>% 
  arrange(-average_speeches) %>% 
  kablebox()

# as a table per state
d %>% 
  filter(chamber == "House") %>%
  group_by(state) %>% 
  summarise(average_speeches = mean(n_speeches) %>% round() ) %>% 
  kablebox()



# as a map
states <- map_data("state") %>% rename(state = region)

d %>% 
  filter(chamber == "House") %>%
  group_by(state) %>% 
  summarise(average_speeches = mean(n_speeches) ) %>% 
  left_join(states) %>% 
  group_by(subregion) %>%
  ggplot( aes(x = long, y = lat, group = group, fill = average_speeches) ) +
  geom_polygon(color = "white") + 
  theme_void()


d %>% 
  filter(chamber == "House") %>%
  group_by(state, year) %>% 
  summarise(average_speeches = mean(n_speeches) ) %>% 
  left_join(states) %>% 
  group_by(subregion) %>%
  ggplot( aes(x = long, y = lat, group = group, fill = average_speeches) ) +
  geom_polygon(color = "white") + 
  theme_void() +
  facet_wrap("year")
```

## Counts of speeches by type

> TODO: Excluding proceedural speeches

> TODO: Legislative vs non-legislative

## Counts of speeches mentioning district